app-id: net.gaijin.WarThunder
runtime: org.gnome.Platform
runtime-version: '41'
sdk: org.gnome.Sdk
command: run.sh
tags:
  - proprietary
finish-args:
  - --device=dri # GPU
  - --socket=x11 # X11
  - --socket=wayland # Gamescope
  - --socket=fallback-x11 # Gamescope on X11
  # =all for controller support
  - --device=all
  - --socket=pulseaudio
  - --share=network
    # gamescope
  - --env=PATH=/app/bin:/app/utils/gamescope/bin:/usr/bin

add-extensions:
  com.valvesoftware.Steam.Utility.gamescope:
    version: stable
    add-ld-path: lib
    directory: utils/gamescope

modules:
  - name: gamescope
    buildsystem: simple
    build-commands:
      - mkdir -p /app/utils/gamescope
  - name: warthunder
    buildsystem: simple
    build-commands:
      - install -D -t "${FLATPAK_DEST}/bin/" ./run.sh
      - install -D ./apply_extra.sh "${FLATPAK_DEST}/bin/apply_extra"
      - install -D -t "${FLATPAK_DEST}/share/applications/" ./net.gaijin.WarThunder.desktop
      - install -D ./net.gaijin.WarThunder-128.png "/app/share/icons/hicolor/128x128/apps/net.gaijin.WarThunder.png"
      - install -D -t "${FLATPAK_DEST}/share/metainfo/" ./net.gaijin.WarThunder.metainfo.xml
    sources:
      - type: extra-data
        filename: wt.tar.gz
        url: https://aws-yup-distr-03.gaijinent.com/wt_launcher_linux_0.9.4.83.tar.gz
        sha256: 1b67e6d4ba87716efb81d64abd44285daf5d8f8ddb501299cde7dd3b9df2d156
        # curl -s -L -I "URL" | gawk -v IGNORECASE=1 '/^Content-Length/ { print $2 }'
        x-checker-data:
          type: rotating-url
          url: https://yupmaster.gaijinent.com/launcher/current.php?id=WarThunderLauncherLinux
          pattern: https://cdnnow-distr.gaijinent.com/wt_launcher_linux_([0-9.]+).tar.gz
        size: 19910436
      - type: file
        path: run.sh
      - type: file
        path: net.gaijin.WarThunder.desktop
      - type: file
        path: apply_extra.sh
      - type: file
        path: net.gaijin.WarThunder.metainfo.xml
      - type: file
        path: icons/net.gaijin.WarThunder-128.png
